{"ast":null,"code":"import { safelyRunOnBrowser } from \"../lib/utils/index.js\";\n\nfunction extractPayload(widgets, instantSearchInstance, payload) {\n  var parent = instantSearchInstance.mainIndex;\n  var initOptions = {\n    instantSearchInstance: instantSearchInstance,\n    parent: parent,\n    scopedResults: [],\n    state: parent.getHelper().state,\n    helper: parent.getHelper(),\n    createURL: parent.createURL,\n    uiState: instantSearchInstance._initialUiState,\n    renderState: instantSearchInstance.renderState,\n    templatesConfig: instantSearchInstance.templatesConfig,\n    searchMetadata: {\n      isSearchStalled: instantSearchInstance._isSearchStalled\n    }\n  };\n  widgets.forEach(function (widget) {\n    var widgetParams = {};\n\n    if (widget.getWidgetRenderState) {\n      var renderState = widget.getWidgetRenderState(initOptions);\n\n      if (renderState && renderState.widgetParams) {\n        // casting, as we just earlier checked widgetParams exists, and thus an object\n        widgetParams = renderState.widgetParams;\n      }\n    } // since we destructure in all widgets, the parameters with defaults are set to \"undefined\"\n\n\n    var params = Object.keys(widgetParams).filter(function (key) {\n      return widgetParams[key] !== undefined;\n    });\n    payload.widgets.push({\n      type: widget.$$type,\n      widgetType: widget.$$widgetType,\n      params: params\n    });\n\n    if (widget.$$type === 'ais.index') {\n      extractPayload(widget.getWidgets(), instantSearchInstance, payload);\n    }\n  });\n}\n\nexport function isMetadataEnabled() {\n  return safelyRunOnBrowser(function (_ref) {\n    var _window$navigator, _window$navigator$use;\n\n    var window = _ref.window;\n    return ((_window$navigator = window.navigator) === null || _window$navigator === void 0 ? void 0 : (_window$navigator$use = _window$navigator.userAgent) === null || _window$navigator$use === void 0 ? void 0 : _window$navigator$use.indexOf('Algolia Crawler')) > -1;\n  }, {\n    fallback: function fallback() {\n      return false;\n    }\n  });\n}\n/**\n * Exposes the metadata of mounted widgets in a custom\n * `<meta name=\"instantsearch:widgets\" />` tag. The metadata per widget is:\n * - applied parameters\n * - widget name\n * - connector name\n */\n\nexport function createMetadataMiddleware() {\n  return function (_ref2) {\n    var instantSearchInstance = _ref2.instantSearchInstance;\n    var payload = {\n      widgets: []\n    };\n    var payloadContainer = document.createElement('meta');\n    var refNode = document.querySelector('head');\n    payloadContainer.name = 'instantsearch:widgets';\n    return {\n      onStateChange: function onStateChange() {},\n      subscribe: function subscribe() {\n        // using setTimeout here to delay extraction until widgets have been added in a tick (e.g. Vue)\n        setTimeout(function () {\n          var client = instantSearchInstance.client;\n          payload.ua = client.transporter && client.transporter.userAgent ? client.transporter.userAgent.value : client._ua;\n          extractPayload(instantSearchInstance.mainIndex.getWidgets(), instantSearchInstance, payload);\n          payloadContainer.content = JSON.stringify(payload);\n          refNode.appendChild(payloadContainer);\n        }, 0);\n      },\n      unsubscribe: function unsubscribe() {\n        payloadContainer.remove();\n      }\n    };\n  };\n}","map":{"version":3,"names":["safelyRunOnBrowser","extractPayload","widgets","instantSearchInstance","payload","parent","mainIndex","initOptions","scopedResults","state","getHelper","helper","createURL","uiState","_initialUiState","renderState","templatesConfig","searchMetadata","isSearchStalled","_isSearchStalled","forEach","widget","widgetParams","getWidgetRenderState","params","Object","keys","filter","key","undefined","push","type","$$type","widgetType","$$widgetType","getWidgets","isMetadataEnabled","_ref","_window$navigator","_window$navigator$use","window","navigator","userAgent","indexOf","fallback","createMetadataMiddleware","_ref2","payloadContainer","document","createElement","refNode","querySelector","name","onStateChange","subscribe","setTimeout","client","ua","transporter","value","_ua","content","JSON","stringify","appendChild","unsubscribe","remove"],"sources":["/Users/christoalex/Algolia/my-app/node_modules/instantsearch.js/es/middlewares/createMetadataMiddleware.js"],"sourcesContent":["import { safelyRunOnBrowser } from \"../lib/utils/index.js\";\n\nfunction extractPayload(widgets, instantSearchInstance, payload) {\n  var parent = instantSearchInstance.mainIndex;\n  var initOptions = {\n    instantSearchInstance: instantSearchInstance,\n    parent: parent,\n    scopedResults: [],\n    state: parent.getHelper().state,\n    helper: parent.getHelper(),\n    createURL: parent.createURL,\n    uiState: instantSearchInstance._initialUiState,\n    renderState: instantSearchInstance.renderState,\n    templatesConfig: instantSearchInstance.templatesConfig,\n    searchMetadata: {\n      isSearchStalled: instantSearchInstance._isSearchStalled\n    }\n  };\n  widgets.forEach(function (widget) {\n    var widgetParams = {};\n\n    if (widget.getWidgetRenderState) {\n      var renderState = widget.getWidgetRenderState(initOptions);\n\n      if (renderState && renderState.widgetParams) {\n        // casting, as we just earlier checked widgetParams exists, and thus an object\n        widgetParams = renderState.widgetParams;\n      }\n    } // since we destructure in all widgets, the parameters with defaults are set to \"undefined\"\n\n\n    var params = Object.keys(widgetParams).filter(function (key) {\n      return widgetParams[key] !== undefined;\n    });\n    payload.widgets.push({\n      type: widget.$$type,\n      widgetType: widget.$$widgetType,\n      params: params\n    });\n\n    if (widget.$$type === 'ais.index') {\n      extractPayload(widget.getWidgets(), instantSearchInstance, payload);\n    }\n  });\n}\n\nexport function isMetadataEnabled() {\n  return safelyRunOnBrowser(function (_ref) {\n    var _window$navigator, _window$navigator$use;\n\n    var window = _ref.window;\n    return ((_window$navigator = window.navigator) === null || _window$navigator === void 0 ? void 0 : (_window$navigator$use = _window$navigator.userAgent) === null || _window$navigator$use === void 0 ? void 0 : _window$navigator$use.indexOf('Algolia Crawler')) > -1;\n  }, {\n    fallback: function fallback() {\n      return false;\n    }\n  });\n}\n/**\n * Exposes the metadata of mounted widgets in a custom\n * `<meta name=\"instantsearch:widgets\" />` tag. The metadata per widget is:\n * - applied parameters\n * - widget name\n * - connector name\n */\n\nexport function createMetadataMiddleware() {\n  return function (_ref2) {\n    var instantSearchInstance = _ref2.instantSearchInstance;\n    var payload = {\n      widgets: []\n    };\n    var payloadContainer = document.createElement('meta');\n    var refNode = document.querySelector('head');\n    payloadContainer.name = 'instantsearch:widgets';\n    return {\n      onStateChange: function onStateChange() {},\n      subscribe: function subscribe() {\n        // using setTimeout here to delay extraction until widgets have been added in a tick (e.g. Vue)\n        setTimeout(function () {\n          var client = instantSearchInstance.client;\n          payload.ua = client.transporter && client.transporter.userAgent ? client.transporter.userAgent.value : client._ua;\n          extractPayload(instantSearchInstance.mainIndex.getWidgets(), instantSearchInstance, payload);\n          payloadContainer.content = JSON.stringify(payload);\n          refNode.appendChild(payloadContainer);\n        }, 0);\n      },\n      unsubscribe: function unsubscribe() {\n        payloadContainer.remove();\n      }\n    };\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}